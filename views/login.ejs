<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        <%= title %>
    </title>
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="stylesheet" href="/styles/main.css" />
</head>

<body>
    <header class="topbar">
        <h2><a href="/" style="text-decoration: none; color: inherit; display: flex; align-items: center; cursor: pointer; transition: opacity 0.2s ease;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">
            <img src="/logo.png" alt="Terp Notes Logo" style="width: 32px; height: 32px; vertical-align: middle; margin-right: 8px; pointer-events: none;" />
            Terp Notes
        </a></h2>
        <div class="user-info">
            <a href="/" class="logout-btn" onclick="console.log('Home button clicked'); return true;">Home</a>
            <a href="/register" class="logout-btn" style="margin-left: 1rem;">Register</a>
        </div>
    </header>

    <main class="centered">
        <div class="auth-form">
            <h1>Login to Terp Notes</h1>

            <!-- Session Expired Message -->
            <div id="sessionExpiredMessage" style="display: none; background: #FEF3C7; border: 1px solid #F59E0B; color: #92400E; padding: 12px 16px; border-radius: 8px; margin-bottom: 1rem; font-size: 0.875rem;">
                <strong><img src="/images/icons/clock-warning.png" alt="Warning" style="width: 40px; height: 40px; vertical-align: middle; margin-right: 10px;" /> Session Expired</strong>
                <p style="margin: 0.5rem 0 0 0;" id="expiryMessage"></p>
            </div>

            <form action="/loginSubmit" method="POST" novalidate>
                <div class="form-group">
                    <label for="userid">Username<span class="req">*</span></label>
                    <input type="text" name="userid" id="userid" placeholder="Enter your username" />
                </div>
                <div class="form-group">
                    <label for="password">Password<span class="req">*</span></label>
                    <input type="password" name="password" id="password" placeholder="Enter your password" />
                </div>
                <div class="form-buttons">
                    <input type="submit" value="Login" class="button danger" id="loginBtn" />
                    <input type="reset" value="Clear" class="button secondary" />
                </div>

                <!-- Notification container -->
                <div id="notificationContainer" style="margin-top: 1rem;"></div>
            </form>
            <div class="alt-link">
                <p><a href="/forgot-password">Forgot your password?</a></p>
                <p>Don't have an account? <a href="/register">Sign up here</a></p>
            </div>
        </div>
    </main>

    <%- include('partials/footer') %>

    <script>
        // Notification system
        function showNotification(message, type = 'error') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');

            const bgColor = type === 'error' ? '#FEF2F2' : '#F0FDF4';
            const borderColor = type === 'error' ? '#FECACA' : '#BBF7D0';
            const textColor = type === 'error' ? '#DC2626' : '#16A34A';
            const icon = type === 'error' ? '⚠️' : '✅';

            notification.style.cssText = `
                background: ${bgColor};
                border: 1px solid ${borderColor};
                color: ${textColor};
                padding: 12px 16px;
                border-radius: 8px;
                margin-bottom: 0.5rem;
                font-size: 0.875rem;
                display: flex;
                align-items: center;
                animation: slideDown 0.3s ease;
            `;

            notification.innerHTML = `
                <span style="margin-right: 8px; font-size: 1rem;">${icon}</span>
                <span>${message}</span>
            `;

            container.innerHTML = '';
            container.appendChild(notification);

            // Auto-hide after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideUp 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }

        // Check for session expired message in URL
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('session_expired') === 'true') {
            const message = urlParams.get('message') || 'Your session has expired. Please login again.';
            const messageDiv = document.getElementById('sessionExpiredMessage');
            const messageText = document.getElementById('expiryMessage');

            if (messageDiv && messageText) {
                messageText.textContent = message;
                messageDiv.style.display = 'block';

                // Auto-hide after 10 seconds
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 10000);
            }

            // Clean URL (remove query params)
            window.history.replaceState({}, document.title, '/login');
        }

        // Login form validation
        document.addEventListener('DOMContentLoaded', function () {
            // Form submission validation
            document.querySelector('form').addEventListener('submit', function(e) {
                const username = document.getElementById('userid').value.trim();
                const password = document.getElementById('password').value;

                const missingFields = [];

                if (!username) missingFields.push('Username');
                if (!password) missingFields.push('Password');

                if (missingFields.length > 0) {
                    e.preventDefault(); // Prevent form submission
                    showNotification('Please complete the following required fields:<br>• ' + missingFields.join('<br>• '));
                    return false;
                }
            });
        });
    </script>
</body>

</html>
