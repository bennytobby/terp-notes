<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        <%= title %>
    </title>
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="stylesheet" href="/styles/main.css" />
</head>

<body>
    <header class="topbar">
        <h2>Terp Notes</h2>
        <div class="user-info">
            <a href="/" class="logout-btn">Home</a>
        </div>
    </header>

    <main class="centered">
        <div class="auth-form">
            <h1>Login to Terp Notes</h1>

            <!-- Session Expired Message -->
            <div id="sessionExpiredMessage" style="display: none; background: #FEF3C7; border: 1px solid #F59E0B; color: #92400E; padding: 12px 16px; border-radius: 8px; margin-bottom: 1rem; font-size: 0.875rem;">
                <strong><img src="/images/icons/clock-warning.png" alt="Warning" style="width: 40px; height: 40px; vertical-align: middle; margin-right: 10px;" /> Session Expired</strong>
                <p style="margin: 0.5rem 0 0 0;" id="expiryMessage"></p>
            </div>

            <form action="/loginSubmit" method="POST">
                <div class="form-group">
                    <label for="userid">Username<span class="req">*</span></label>
                    <input type="text" name="userid" id="userid" required placeholder="Enter your username" />
                </div>
                <div class="form-group">
                    <label for="password">Password<span class="req">*</span></label>
                    <input type="password" name="password" id="password" required placeholder="Enter your password" />
                </div>
                <div class="form-buttons">
                    <input type="submit" value="Login" class="button primary" />
                    <input type="reset" value="Clear" class="button secondary" />
                </div>
            </form>
            <div class="alt-link">
                <p><a href="/forgot-password">Forgot your password?</a></p>
                <p>Don't have an account? <a href="/register">Sign up here</a></p>
            </div>
        </div>
    </main>

    <%- include('partials/footer') %>

    <script>
        // Check for session expired message in URL
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('session_expired') === 'true') {
            const message = urlParams.get('message') || 'Your session has expired. Please login again.';
            const messageDiv = document.getElementById('sessionExpiredMessage');
            const messageText = document.getElementById('expiryMessage');

            if (messageDiv && messageText) {
                messageText.textContent = message;
                messageDiv.style.display = 'block';

                // Auto-hide after 10 seconds
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 10000);
            }

            // Clean URL (remove query params)
            window.history.replaceState({}, document.title, '/login');
        }
    </script>
</body>

</html>
