<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        <%= title %>
    </title>
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="stylesheet" href="/styles/main.css" />
</head>

<body>
    <header class="topbar">
        <h2><a href="/" style="text-decoration: none; color: inherit; display: flex; align-items: center; cursor: pointer; transition: opacity 0.2s ease;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">
            <img src="/logo.png" alt="Terp Notes Logo" style="width: 32px; height: 32px; vertical-align: middle; margin-right: 8px; pointer-events: none;" />
            Terp Notes
        </a></h2>
        <div class="user-info">
            <a href="/" class="logout-btn">Home</a>
            <a href="/login" class="logout-btn" style="margin-left: 1rem;">Login</a>
        </div>
    </header>

    <main class="centered">
        <div class="auth-form">
            <h1>Join Terp Notes</h1>
            <form action="/registerSubmit" method="POST">
                <div class="form-group">
                    <label for="first_name">First Name<span class="req">*</span></label>
                    <input type="text" name="first_name" id="first_name" required placeholder="John" />
                </div>
                <div class="form-group">
                    <label for="last_name">Last Name<span class="req">*</span></label>
                    <input type="text" name="last_name" id="last_name" required placeholder="Doe" />
                </div>
                <div class="form-group">
                    <label for="userid">Username<span class="req">*</span></label>
                    <input type="text" name="userid" id="userid" required placeholder="johndoe" />
                    <div class="username-warning">
                        <strong><img src="/images/icons/warning-triangle.png" alt="Warning" style="width: 40px; height: 40px; vertical-align: middle; margin-right: 10px;" /> Important:</strong> Your username is <strong>permanent</strong> and cannot be changed
                        later. Choose carefully!
                    </div>
                </div>
                <div class="form-group">
                    <label for="email">Email<span class="req">*</span></label>
                    <input type="email" name="email" id="email" required placeholder="john@terpmail.umd.edu" />
                </div>
                <div class="form-group">
                    <label for="password">Password<span class="req">*</span></label>
                    <input type="password" name="password" id="password" required
                        placeholder="Enter a secure password" />
                    <div class="password-requirements" style="margin-top: 0.5rem; padding: 0.75rem; background: #F3F4F6; border-radius: 6px; font-size: 0.813rem;">
                        <strong style="color: #374151;">Password must include:</strong>
                        <ul style="margin: 0.5rem 0 0 1.25rem; padding: 0; color: #6B7280;">
                            <li id="req-length">At least 8 characters</li>
                            <li id="req-uppercase">At least one uppercase letter (A-Z)</li>
                            <li id="req-lowercase">At least one lowercase letter (a-z)</li>
                            <li id="req-number">At least one number (0-9)</li>
                            <li id="req-special">At least one special character (!@#$%^&*...)</li>
                        </ul>
                    </div>
                    <div id="password-strength" style="margin-top: 0.5rem; display: none;">
                        <div style="height: 4px; background: #E5E7EB; border-radius: 4px; overflow: hidden;">
                            <div id="strength-bar" style="height: 100%; width: 0%; transition: all 0.3s;"></div>
                        </div>
                        <p id="strength-text" style="margin: 0.25rem 0 0 0; font-size: 0.75rem;"></p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="confirm_pass">Confirm Password<span class="req">*</span></label>
                    <input type="password" name="confirm_pass" id="confirm_pass" required
                        placeholder="Re-enter your password" />
                </div>
                <div class="form-group terms-agreement">
                    <div class="terms-box">
                        <h4><img src="/images/icons/document.png" alt="Document" style="width: 36px; height: 36px; vertical-align: middle; margin-right: 10px;" /> Legal Agreement</h4>
                        <p class="terms-text">
                            By creating an account, you must read and accept:
                        </p>

                        <label class="checkbox-label" style="margin: 1rem 0; display: flex; align-items: flex-start;">
                            <input type="checkbox" id="agreeTerms" name="agreeTerms" required
                                style="margin-top: 0.25rem; flex-shrink: 0;">
                            <span style="margin-left: 0.5rem;">I have read and accept the
                                <a href="/terms" target="_blank"
                                    style="color: var(--umd-red); font-weight: 600; text-decoration: underline;">Terms
                                    of Service</a>
                            </span>
                        </label>

                        <label class="checkbox-label" style="margin: 1rem 0; display: flex; align-items: flex-start;">
                            <input type="checkbox" id="agreePrivacy" name="agreePrivacy" required
                                style="margin-top: 0.25rem; flex-shrink: 0;">
                            <span style="margin-left: 0.5rem;">I have read and accept the
                                <a href="/privacy" target="_blank"
                                    style="color: var(--umd-red); font-weight: 600; text-decoration: underline;">Privacy
                                    Policy</a>
                            </span>
                        </label>

                        <div
                            style="background: #FEF3C7; padding: 1rem; border-radius: 8px; margin-top: 1rem; font-size: 0.875rem; line-height: 1.6; border: 1px solid #F59E0B;">
                            <strong><img src="/images/icons/info-circle.png" alt="Info" style="width: 40px; height: 40px; vertical-align: middle; margin-right: 10px;" /> Quick Summary:</strong>
                            <ul style="margin: 0.5rem 0 0 1.25rem; padding: 0;">
                                <li>Educational purposes only</li>
                                <li>No unauthorized exam/project sharing</li>
                                <li>Respect academic integrity</li>
                                <li>Independent platform (NOT affiliated with UMD)</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="form-buttons">
                    <input type="submit" value="Sign Up" class="button danger" id="submitBtn" />
                    <input type="reset" value="Clear" class="button secondary" />
                </div>
            </form>
            <div class="alt-link">
                <p>Already have an account? <a href="/login">Login here</a></p>
            </div>
        </div>
    </main>

    <script>
        // Password match validation for registration
        document.addEventListener('DOMContentLoaded', function () {
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm_pass');
            const termsCheckbox = document.getElementById('agreeTerms');
            const privacyCheckbox = document.getElementById('agreePrivacy');
            const submitBtn = document.getElementById('submitBtn');

            // Password strength checking
            function checkPasswordStrength(password) {
                const requirements = {
                    length: password.length >= 8,
                    uppercase: /[A-Z]/.test(password),
                    lowercase: /[a-z]/.test(password),
                    number: /[0-9]/.test(password),
                    special: /[!@#$%^&*()_+\-=\[\]{}|;:,.<>?]/.test(password)
                };

                // Update requirement checkmarks
                document.getElementById('req-length').style.color = requirements.length ? '#10B981' : '#6B7280';
                document.getElementById('req-uppercase').style.color = requirements.uppercase ? '#10B981' : '#6B7280';
                document.getElementById('req-lowercase').style.color = requirements.lowercase ? '#10B981' : '#6B7280';
                document.getElementById('req-number').style.color = requirements.number ? '#10B981' : '#6B7280';
                document.getElementById('req-special').style.color = requirements.special ? '#10B981' : '#6B7280';

                document.getElementById('req-length').innerHTML = requirements.length ? '✓ At least 8 characters' : 'At least 8 characters';
                document.getElementById('req-uppercase').innerHTML = requirements.uppercase ? '✓ At least one uppercase letter (A-Z)' : 'At least one uppercase letter (A-Z)';
                document.getElementById('req-lowercase').innerHTML = requirements.lowercase ? '✓ At least one lowercase letter (a-z)' : 'At least one lowercase letter (a-z)';
                document.getElementById('req-number').innerHTML = requirements.number ? '✓ At least one number (0-9)' : 'At least one number (0-9)';
                document.getElementById('req-special').innerHTML = requirements.special ? '✓ At least one special character (!@#$%^&*...)' : 'At least one special character (!@#$%^&*...)';

                // Calculate strength score
                let score = 0;
                if (password.length >= 8) score += 20;
                if (password.length >= 12) score += 10;
                if (requirements.uppercase) score += 20;
                if (requirements.lowercase) score += 20;
                if (requirements.number) score += 15;
                if (requirements.special) score += 15;

                // Show strength indicator
                const strengthBar = document.getElementById('strength-bar');
                const strengthText = document.getElementById('strength-text');
                const strengthContainer = document.getElementById('password-strength');

                if (password.length > 0) {
                    strengthContainer.style.display = 'block';
                    strengthBar.style.width = score + '%';

                    if (score >= 80) {
                        strengthBar.style.background = '#10B981'; // Green
                        strengthText.textContent = 'Strong password';
                        strengthText.style.color = '#10B981';
                    } else if (score >= 50) {
                        strengthBar.style.background = '#F59E0B'; // Yellow
                        strengthText.textContent = 'Medium password';
                        strengthText.style.color = '#F59E0B';
                    } else {
                        strengthBar.style.background = '#EF4444'; // Red
                        strengthText.textContent = 'Weak password';
                        strengthText.style.color = '#EF4444';
                    }
                } else {
                    strengthContainer.style.display = 'none';
                }

                // Return if all requirements met
                return Object.values(requirements).every(req => req);
            }

            function checkFormValidity() {
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;
                const termsAgreed = termsCheckbox.checked;
                const privacyAgreed = privacyCheckbox.checked;

                // Check password strength
                const passwordStrong = checkPasswordStrength(password);

                // Remove existing error message
                const existingError = confirmPasswordInput.parentElement.querySelector('.password-match-error');
                if (existingError) existingError.remove();

                let passwordsValid = passwordStrong;

                // Only show error if confirm password field has content
                if (confirmPassword && password !== confirmPassword) {
                    const errorDiv = document.createElement('small');
                    errorDiv.className = 'password-match-error';
                    errorDiv.style.color = '#EF4444';
                    errorDiv.style.display = 'block';
                    errorDiv.style.marginTop = '0.5rem';
                    errorDiv.textContent = 'Passwords do not match';
                    confirmPasswordInput.parentElement.appendChild(errorDiv);
                    passwordsValid = false;
                } else if (confirmPassword && password === confirmPassword) {
                    const successDiv = document.createElement('small');
                    successDiv.className = 'password-match-error';
                    successDiv.style.color = '#10B981';
                    successDiv.style.display = 'block';
                    successDiv.style.marginTop = '0.5rem';
                    successDiv.textContent = '✓ Passwords match';
                    confirmPasswordInput.parentElement.appendChild(successDiv);
                }

                // Disable submit if passwords don't match OR terms/privacy not agreed
                if (!passwordsValid || !termsAgreed || !privacyAgreed) {
                    submitBtn.disabled = true;
                    submitBtn.style.opacity = '0.5';
                    submitBtn.style.cursor = 'not-allowed';
                } else {
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';
                    submitBtn.style.cursor = 'pointer';
                }
            }

            passwordInput.addEventListener('input', checkFormValidity);
            confirmPasswordInput.addEventListener('input', checkFormValidity);
            termsCheckbox.addEventListener('change', checkFormValidity);
            privacyCheckbox.addEventListener('change', checkFormValidity);

            // Initial check
            checkFormValidity();
        });
    </script>

    <%- include('partials/footer') %>
</body>

</html>
